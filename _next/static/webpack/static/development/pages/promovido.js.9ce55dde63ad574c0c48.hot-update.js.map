{"version":3,"file":"static/webpack/static/development/pages/promovido.js.9ce55dde63ad574c0c48.hot-update.js","sources":["webpack:///./actions/auth.js"],"sourcesContent":["import React, { Component } from 'react'\nimport Router from 'next/router'\nimport nextCookie from 'next-cookies'\nimport { actionTypes, URL } from './types'\nimport fetch from 'isomorphic-unfetch';\n\nexport const login = (username, password) => async dispatch => {\n    const response = await fetch(`${URL}/auth/login/`, {\n        method: 'POST',\n        headers: {\n            \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n            'target': 'auth',\n            'action': 'login',\n            'depth': 1,\n            'model': {\n                username,\n                password\n            }\n        })\n    });\n    if(response.ok){\n        Router.push('/');\n        let state = dispatch({\n            type: actionTypes.LOGIN_SUCCESS,\n            payload: await response.json()\n        });\n        state = state.payload;\n        dispatch({\n            type: actionTypes.GLOBAL_GET_PROCESS,\n            payload: state.profile.process\n        });\n        dispatch({\n            type: actionTypes.GLOBAL_SET_PROCESS,\n            payload: state.profile.process[0].id\n        });\n        dispatch({\n            type: actionTypes.GLOBAL_GET_CANDIDATES,\n            payload: state.profile.process[0].candidates\n        });\n        dispatch({\n            type: actionTypes.GLOBAL_SET_CANDIDATE,\n            payload: state.profile.process[0].candidates[0].id\n        });\n        return state;\n    } else {\n        return dispatch({type: actionTypes.AUTH_ERROR});\n    }\n};\n\nexport const logout = (token) => async dispatch => {\n    const response = await fetch(`${URL}/auth/logout/`, {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Token ${token}`\n        },\n        body: null\n    });\n    Router.push('/login');\n    dispatch({ type: actionTypes.LOGOUT_SUCCESS });\n    dispatch({ type: actionTypes.DELETE_NOMINAL_LIST });\n    dispatch({ type: actionTypes.DELETE_PROMOTED});\n};\n\n// Gets the display name of a JSX component for dev tools\nconst getDisplayName = Component => Component.displayName || Component.name || 'Component';\n\nexport const withAuthSync = WrappedComponent => class extends Component {\n    static displayName = `withAuthSync(${getDisplayName(WrappedComponent)})`;\n\n    static async getInitialProps (ctx) {\n        const token = auth(ctx);\n\n        const componentProps =\n            WrappedComponent.getInitialProps &&\n            (await WrappedComponent.getInitialProps(ctx));\n\n        return { ...componentProps, token }\n    }\n\n    constructor (props) {\n        super(props);\n\n        this.syncLogout = this.syncLogout.bind(this)\n    }\n\n    componentDidMount () {\n        window.addEventListener('storage', this.syncLogout)\n    }\n\n    componentWillUnmount () {\n        window.removeEventListener('storage', this.syncLogout);\n        window.localStorage.removeItem('logout')\n    }\n\n    syncLogout (event) {\n        if (event.key === 'logout') {\n            console.log('logged out from storage!');\n            Router.push('/login')\n        }\n    }\n\n    render () {\n        return <WrappedComponent {...this.props} />\n    }\n};\n\nexport const auth = ctx => {\n    const { token } = nextCookie(ctx);\n\n    /*\n     * This happens on server only, ctx.req is available means it's being\n     * rendered on server. If we are on server and token is not available,\n     * means user is not logged in.\n     */\n    if (ctx.req && !token) {\n        ctx.res.writeHead(302, { Location: '/login' });\n        ctx.res.end();\n        return\n    }\n\n    // We already checked for server. This should only happen on client.\n    if (!token) {\n        Router.push('/login')\n    }\n\n    return token\n};"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAJA;AALA;AACA;AAFA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AACA;AAgBA;AAjBA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAmBA;AACA;AApBA;AAkBA;AAIA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAnCA;AACA;AADA;AAAA;AAyCA;AAAA;AACA;AA1CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AA6CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAFA;AAIA;AANA;AACA;AAFA;AACA;AAQA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAbA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAeA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAJA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAMA;AANA;AAUA;AAVA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AAYA;AAAA;AACA;AADA;AACA;AAAA;AAEA;AAHA;AAIA;AACA;AAlBA;AAAA;AAAA;AAoBA;AACA;AArBA;AAAA;AAAA;AAwBA;AACA;AACA;AA1BA;AAAA;AAAA;AA6BA;AACA;AACA;AACA;AACA;AAjCA;AAAA;AAAA;AAoCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AArCA;AACA;AADA;AAAA;AAAA;AAwCA;AAAA;AAAA;AAGA;;;;;;;AAKA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}